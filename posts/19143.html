<!DOCTYPE HTML><html lang="zh-CN"><head><meta charset="utf-8"><meta name="keywords" content="Flow Matching: Flow Matching for Generative Modeling, DaNing的博客"><meta name="description" content="DaNing的个人博客."><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><meta name="renderer" content="webkit|ie-stand|ie-comp"><meta name="mobile-web-app-capable" content="yes"><meta name="format-detection" content="telephone=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><title>Flow Matching: Flow Matching for Generative Modeling | DaNing的博客</title><link rel="icon" type="image/png" href="https://cdn.jsdelivr.net/gh/ADAning/ADAning.github.io/medias/favicon.png"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/ADAning/ADAning.github.io/libs/awesome/css/all.css"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/ADAning/ADAning.github.io/libs/materialize/materialize.min.css"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/ADAning/ADAning.github.io/libs/aos/aos.css"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/ADAning/ADAning.github.io/libs/animate/animate.min.css"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/ADAning/ADAning.github.io/libs/lightGallery/css/lightgallery.min.css"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/ADAning/ADAning.github.io/css/matery.css"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/ADAning/ADAning.github.io/css/my.css"><script src="https://cdn.jsdelivr.net/gh/ADAning/ADAning.github.io/libs/jquery/jquery.min.js"></script><meta name="generator" content="Hexo 4.2.1"><link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"><link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"><link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head><body><header class="navbar-fixed"><nav id="headNav" class="bg-color nav-transparent"><div id="navContainer" class="nav-wrapper container"><div class="brand-logo"><a href="/" class="waves-effect waves-light"><img src="https://cdn.jsdelivr.net/gh/ADAning/ADAning.github.io/medias/logo.png" class="logo-img" alt="LOGO"> <span class="logo-span">DaNing的博客</span></a></div><a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a><ul class="right nav-menu"><li class="hide-on-med-and-down nav-item"><a href="/" class="waves-effect waves-light"><i class="fas fa-home" style="zoom:.6"></i> <span>首页</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/tags" class="waves-effect waves-light"><i class="fas fa-tags" style="zoom:.6"></i> <span>标签</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/categories" class="waves-effect waves-light"><i class="fas fa-bookmark" style="zoom:.6"></i> <span>分类</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/about" class="waves-effect waves-light"><i class="fas fa-user-circle" style="zoom:.6"></i> <span>关于</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/contact" class="waves-effect waves-light"><i class="fas fa-comments" style="zoom:.6"></i> <span>留言板</span></a></li><li class="hide-on-med-and-down nav-item"><a href="" class="waves-effect waves-light"><i class="fas fa-tools" style="zoom:.6"></i> <span>工具</span> <i class="fas fa-chevron-down" aria-hidden="true" style="zoom:.6"></i></a><ul class="sub-nav menus_item_child"><li><a href="/shortcut"><i class="fas fa-rocket" style="margin-top:-20px;zoom:.6"></i> <span>导航(待完善)</span></a></li><li><a href="/helpyoubaidu"><i class="fas fa-wheelchair" style="margin-top:-20px;zoom:.6"></i> <span>帮你百度</span></a></li></ul></li><li><a href="#searchModal" class="modal-trigger waves-effect waves-light"><i id="searchIcon" class="fas fa-search" title="搜索" style="zoom:.85"></i></a></li></ul><div id="mobile-nav" class="side-nav sidenav"><div class="mobile-head bg-color"><img src="https://cdn.jsdelivr.net/gh/ADAning/ADAning.github.io/medias/logo.png" class="logo-img circle responsive-img"><div class="logo-name">DaNing的博客</div><div class="logo-desc">DaNing的个人博客.</div></div><ul class="menu-list mobile-menu-list"><li class="m-nav-item"><a href="/" class="waves-effect waves-light"><i class="fa-fw fas fa-home"></i> 首页</a></li><li class="m-nav-item"><a href="/tags" class="waves-effect waves-light"><i class="fa-fw fas fa-tags"></i> 标签</a></li><li class="m-nav-item"><a href="/categories" class="waves-effect waves-light"><i class="fa-fw fas fa-bookmark"></i> 分类</a></li><li class="m-nav-item"><a href="/about" class="waves-effect waves-light"><i class="fa-fw fas fa-user-circle"></i> 关于</a></li><li class="m-nav-item"><a href="/contact" class="waves-effect waves-light"><i class="fa-fw fas fa-comments"></i> 留言板</a></li><li class="m-nav-item"><a href="javascript:;"><i class="fa-fw fas fa-tools"></i> 工具 <span class="m-icon"><i class="fas fa-chevron-right"></i></span></a><ul><li><a href="/shortcut" style="margin-left:75px"><i class="fa fas fa-rocket" style="position:absolute;left:50px"></i> <span>导航(待完善)</span></a></li><li><a href="/helpyoubaidu" style="margin-left:75px"><i class="fa fas fa-wheelchair" style="position:absolute;left:50px"></i> <span>帮你百度</span></a></li></ul></li></ul></div></div></nav></header><script src="https://cdn.jsdelivr.net/gh/ADAning/ADAning.github.io/libs/cryptojs/crypto-js.min.js"></script><script></script><div class="bg-cover pd-header post-cover" style="background-image:url(https://cdn.jsdelivr.net/gh/ADAning/ADAning.github.io/medias/featureimages/20.jpg)"><div class="container" style="right:0;left:0"><div class="row"><div class="col s12 m12 l12"><div class="brand"><h1 class="description center-align post-title">Flow Matching: Flow Matching for Generative Modeling</h1></div></div></div></div></div><main class="post-container content"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/ADAning/ADAning.github.io/libs/tocbot/tocbot.css"><style>#articleContent h1::before,#articleContent h2::before,#articleContent h3::before,#articleContent h4::before,#articleContent h5::before,#articleContent h6::before{display:block;content:" ";height:100px;margin-top:-100px;visibility:hidden}#articleContent :focus{outline:0}.toc-fixed{position:fixed;top:64px}.toc-widget{width:345px;padding-left:20px}.toc-widget .toc-title{margin:35px 0 15px 0;padding-left:17px;font-size:1.5rem;font-weight:700;line-height:1.5rem}.toc-widget ol{padding:0;list-style:none}#toc-content{height:calc(100vh - 250px);overflow:auto}#toc-content ol{padding-left:10px}#toc-content ol li{padding-left:10px}#toc-content .toc-link:hover{color:#42b983;font-weight:700;text-decoration:underline}#toc-content .toc-link::before{background-color:transparent;max-height:25px;position:absolute;right:23.5vw;display:block}#toc-content .is-active-link{color:#42b983}#floating-toc-btn{position:fixed;right:15px;bottom:76px;padding-top:15px;margin-bottom:0;z-index:998}#floating-toc-btn .btn-floating{width:48px;height:48px}#floating-toc-btn .btn-floating i{line-height:48px;font-size:1.4rem}</style><div class="row"><div id="main-content" class="col s12 m12 l9"><div id="artDetail"><div class="card"><div class="card-content article-info"><div class="row tag-cate"><div class="col s7"><div class="article-tag"><a href="/tags/Diffusion/"><span class="chip bg-color">Diffusion</span> </a><a href="/tags/Flow/"><span class="chip bg-color">Flow</span> </a><a href="/tags/Flow-Matching/"><span class="chip bg-color">Flow Matching</span></a></div></div><div class="col s5 right-align"><div class="post-cate"><i class="fas fa-bookmark fa-fw icon-category"></i> <a href="/categories/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/" class="post-category">深度学习</a></div></div></div><div class="post-info"><div class="post-date info-break-policy"><i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp; 2025-05-29</div><div class="post-date info-break-policy"><i class="far fa-calendar-check fa-fw"></i>更新日期:&nbsp;&nbsp; 2025-05-29</div><div class="info-break-policy"><i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp; 5k</div><div class="info-break-policy"><i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp; 22 分</div></div></div><hr class="clearfix"><div class="card-content article-card-content"><div id="articleContent"><blockquote><p>本文前置知识:</p><ul><li><strong>Rectified Flow</strong>: <a href="https://adaning.github.io/posts/24725.html">ReFlow: Flow Straight and Fast-Learning to Generate and Transfer Data with Rectified Flow</a>.</li></ul></blockquote><h1 id="Flow-Matching-for-Generative-Modeling"><a href="#Flow-Matching-for-Generative-Modeling" class="headerlink" title="Flow Matching for Generative Modeling"></a>Flow Matching for Generative Modeling</h1><ul><li>论文: <a href="https://arxiv.org/abs/2210.02747" target="_blank" rel="noopener">Flow Matching for Generative Modeling</a>, Meta AI, ICLR 2023.</li><li>代码: <a href="https://github.com/facebookresearch/flow_matching" target="_blank" rel="noopener">GitHub - facebookresearch/flow_matching: A PyTorch library for implementing flow matching algorithms, featuring continuous and discrete flow matching implementations. It includes practical examples for both text and image modalities</a>.</li></ul><p>同期工作与Flow Matching撞车, 本文中的Flow Matching实际上推导出了一种Diffusion Model的更通用的形式, 它们都是在建立已知的噪声分布到数据分布之间的变换关系.</p><ul><li>如果对<a href="https://adaning.github.io/posts/24725.html">Rectified Flow</a>还不够了解, 还是推荐先看<a href="https://adaning.github.io/posts/24725.html">Rectified Flow</a>.</li><li>如果比较关心的是Flow-based Model在应用 / 实现方面的内容, 其实可以不用看本文, 不然会很痛苦.</li></ul><h2 id="Continuous-Normalizing-Flow"><a href="#Continuous-Normalizing-Flow" class="headerlink" title="Continuous Normalizing Flow"></a>Continuous Normalizing Flow</h2><p>对于某空间中数据分布中的数据点$x=(x^1, \dots, x^d) \in \mathbb{R}^d$, 在这个空间中有如下定义:</p><ol><li>概率密度路径$p:[0,1] \times \mathbb{R}^d \rightarrow \mathbb{R}_{&gt;0}$ 是一个满足$\int{p_t(x) dx=1}$ 且与时间$t$ 相关的概率密度函数.</li><li>与时间$t$ 相关的向量场$v:[0,1] \times \mathbb{R}^d \rightarrow \mathbb{R}^d$.</li></ol><p>由于二者都是与时间$t$ 相关的, 出于习惯将$t$ 写在下角标.</p><p>向量场$v_t$ 中可以构造一个与时间相关的微分同胚映射, 即<strong>流</strong>(<strong>Flow</strong>) $\phi: [0, 1] \times \mathbb{R}^d \rightarrow \mathbb{R}^d$, 它可以用<a href="https://zh.wikipedia.org/wiki/%E5%B8%B8%E5%BE%AE%E5%88%86%E6%96%B9%E7%A8%8B" target="_blank" rel="noopener">常微分方程</a>(<strong>ODE</strong>)来定义:</p><p>$$<br>\begin{aligned}<br>\frac{d}{d t} \phi_t(x) &amp; =v_t\left(\phi_t(x)\right) \\<br>\phi_0(x) &amp; =x<br>\end{aligned}<br>$$</p><p>因此:</p><ul><li>流$\phi_t(x)$ 可以理解为获取$t$ 时刻$x$ 在向量场$v_t$ 内的位置的映射, 把它可以想象成一只<strong>有目的地的小船</strong>.</li><li>向量场$v_t$ 可以表征流$\phi_t(x)$ 在$t$ 时刻变化的大小与方向, 可以把它想象成<strong>承载小船的河流中的水流</strong>.</li></ul><p>向量场$v_t$ 其实可以用神经网络来拟合, 记为$v_t(x;\theta)$, 其中$\theta$ 为可学习参数. 在这种视角下的$\phi_t$ 也可以看做是一个深度参数化的模型, 可以称之为<strong>C</strong>ontinuous <strong>N</strong>ormalizing <strong>F</strong>low(<strong>CNF</strong>).</p><blockquote><p>注: 它们之间关系的本质是流$\phi_t(x)$ 是通过向量场$v_t$ 实现的.</p></blockquote><p>CNF可以将一个相对简单的先验概率密度$p_0$ 转换为(推送到, Push-Forward)一个更复杂的概率密度$p_1$:</p><p>$$<br>p_t=\left[\phi_t\right]_\ast p_0<br>$$</p><p>其中的Push-Forward操作符$\ast$ 含义为:</p><p>$$<br>\left[\phi_t\right]_\ast p_0(x)=p_0\left(\phi_t^{-1}(x)\right) \operatorname{det}\left[\frac{\partial \phi_t^{-1}}{\partial x}(x)\right]<br>$$</p><p>如果一个向量场$v_t$ 的流$\phi_t$ 满足$p_t=\left[\phi_t\right]_\ast p_0$, 则称$v_t$ 在$\phi_t$ 下生成了一条概率密度路径$p_t$.</p><p>综上, CNF的目的就是用数据驱动来训练向量场(<strong>耗时耗力开凿河道以引导流向和水速</strong>), 进而实现初始概率分布$p_0$ 到目的概率分布$p_1$ 的转换(<strong>推动小船到达目的地</strong>).</p><p>训练完成后的向量场$v_t$ 在不同的时间下应该长这个样子:</p><img src="https://cdn.jsdelivr.net/gh/ADAning/Image/MLDL/flow matching1.png" style="zoom:50%"><p>通过向量场, 将分布$p_0$ 转换为$p_1$:</p><img src="https://cdn.jsdelivr.net/gh/ADAning/Image/MLDL/flow matching2.png" style="zoom:50%"> <img src="https://cdn.jsdelivr.net/gh/ADAning/Image/MLDL/flow matching3.png" style="zoom:50%"><p>可以用<strong>连续性方程</strong>(<strong>Continuity Equation</strong>)来验证场生成概率密度路径的合理性, 即:</p><p>$$<br>\frac{d}{d t} p_t(x)+\operatorname{div}\left(p_t(x) v_t(x)\right)=0<br>$$</p><p>即对于任意时刻$t$, 在场$v_t$ 中概率密度$p_t$ 的<strong>变化量</strong>$\frac{d}{d t} p_t(x)$ 一定和<strong>概率流的净流出量</strong>$-\operatorname{div}\left(p_t(x) v_t(x)\right)$ 相等. 在后面的推导中, 它是一个至关重要的约束条件.</p><h2 id="Flow-Matching"><a href="#Flow-Matching" class="headerlink" title="Flow Matching"></a>Flow Matching</h2><p>有了CNF的定义, 下面进入正题.</p><p>假如有一随机变量$x_1$ 来自于未知的数据分布$q(x_1)$. 我们没法直接访问$q(x_1)$ 的概率密度函数本身, 但是可以访问这个分布中的一些样本.</p><p>我们可以构造一个概率路径$p_t$, 其起点$p_0=p$ 为一个已知的简单分布, 比如标准正态分布$p(x)=\mathcal{N}(x \mid 0, I)$, 终点$p_1$ 近似于$q$. Flow Matching可以帮助我们找到这个由$p_0$ 到$p_1$ 的概率路径, 从而建模已知分布$p_0$ 转移到数据分布$p_1$ 的过程:</p><img src="https://cdn.jsdelivr.net/gh/ADAning/Image/MLDL/flow matching4.png" style="zoom:50%"><p>对于要学的目标概率密度路径$p_t(x)$ 和其对应的目标向量场$u_t(x)$, Flow Matching的训练目标为:</p><p>$$<br>\mathcal{L}_{\mathrm{FM}}(\theta)=\mathbb{E}_{t, p_t(x)}\left\Vert v_t(x)-u_t(x)\right\Vert ^2<br>$$</p><p>其中, $\theta$ 为参数化向量场$v_t$ 的可学习参数, $t \sim \mathcal{U}[0, 1]$, $x \sim p_t(x)$. 当Loss接近0的时候, 就可以将$v_t(x;\theta)$ 近似为$u_t(x)$, 以此可以用来生成概率密度路径$p_t(x)$.</p><p>然而, 我们对$p_t$ 和$u_t$ 完全未知, 而且会有很多概率路径都能够满足$p_1(x)\approx q(x)$.</p><h3 id="Constructing-Target-from-Conditional-Probability-Paths-and-Vector-Fields"><a href="#Constructing-Target-from-Conditional-Probability-Paths-and-Vector-Fields" class="headerlink" title="Constructing Target from Conditional Probability Paths and Vector Fields"></a>Constructing Target from Conditional Probability Paths and Vector Fields</h3><p>由于没法直接访问$q(x_1)$, 但是可以访问它的样本点. 所以可以考虑将$p_t$ 拆分为多个子问题, 即求解$p_t$ 在各样本点下的条件概率路径的混合.</p><p>对于一个给定的样本$x_1$, 将$p_t(x \mid x_1)$ 表示一个条件概率路径, 使$t=0$ 时满足$p_0(x \mid x_1)=p(x)$, 且令$t=1$ 时满足$p_1(x \mid x_1)$ 为集中在$x_1$ 附近的分布, 例如$\mathcal{N}(x \mid x_1, \sigma^2 I)$, 只要满足$x_1$ 为均值和足够小的标准差$\sigma &gt; 0$ 就可以.</p><blockquote><p>这个概念其实推荐在看完下面的边缘化后, 结合本小节最后的那副图强化一下印象.</p></blockquote><p>因此, 通过对$q(x_1)$ 的边缘化, 得到$t$ 时刻的边缘概率路径$p_t(x)$:</p><p>$$<br>p_t(x)=\int p_t\left(x \mid x_1\right) q\left(x_1\right) d x_1<br>$$</p><p>时间$t=1$ 时, 边缘概率$p_1$ 需要能够近似$q$:</p><p>$$<br>p_1(x)=\int p_1\left(x \mid x_1\right) q\left(x_1\right) d x_1 \approx q(x)<br>$$</p><p>回过头来, <strong>为什么说条件向量场能够表示边缘向量场呢</strong>, 这里面有什么根据吗? 根据连续性方程, 可以证明:</p><p>$$<br>\begin{aligned}<br>\frac{d}{d t} p_t(x) &amp; =\int\left(\frac{d}{d t} p_t\left(x \mid x_1\right)\right) q\left(x_1\right) d x_1=-\int \operatorname{div}\left(u_t\left(x \mid x_1\right) p_t\left(x \mid x_1\right)\right) q\left(x_1\right) d x_1 \\<br>&amp; =-\operatorname{div}\left(\int u_t\left(x \mid x_1\right) p_t\left(x \mid x_1\right) q\left(x_1\right) d x_1\right)=-\operatorname{div}\left(u_t(x) p_t(x)\right)<br>\end{aligned}<br>$$</p><p>将边缘概率路径转换为条件概率路径后, <strong>是否也存在对应的边缘向量场转化为条件向量场呢</strong>? 其实答案就隐藏在刚才的推导里. 在最后两个等号中, 除去散度符号$\operatorname{div}$, 不难发现有:</p><p>$$<br>u_t(x) p_t(x) = \int u_t\left(x \mid x_1\right) p_t\left(x \mid x_1\right) q\left(x_1\right) d x_1<br>$$</p><p>因此, 便可以给出条件向量场表示的边缘向量场定义(假设$p_t(x)&gt;0$):</p><p>$$<br>u_t(x)=\int u_t\left(x \mid x_1\right) \frac{p_t\left(x \mid x_1\right) q\left(x_1\right)}{p_t(x)} d x_1<br>$$</p><p>其中$u_t(\cdot \mid x_1): \mathbb{R}^d \rightarrow \mathbb{R}^d$ 为生成条件概率路径$p_t(\cdot | x_1)$ 的条件向量场.</p><p>因此, 便能够得出一个非常重要的结论: 如果给定的能够生成条件概率路径$p_t(x \mid x_1)$ 的条件向量场$u_t(x \mid x_1)$, 对于任意分布$q(x_1)$, 边缘向量场$u_t$ 都能生成边缘概率路径$p_t$, 且$p_t$, $u_t$ 满足连续性方程.</p><p>如果上面看的迷迷糊糊的, 下面这幅图非常清晰的说明了条件概率路径$p_t(x \mid x_1)$, 边缘概率路径$p_t(x)$, 条件速度场$u_t(x \mid x_1)$ 和边缘速度场$u_t(x)$ 的区别:</p><img src="https://cdn.jsdelivr.net/gh/ADAning/Image/MLDL/flow matching5.png" style="zoom:50%"><h3 id="Conditional-Flow-Matching"><a href="#Conditional-Flow-Matching" class="headerlink" title="Conditional Flow Matching"></a>Conditional Flow Matching</h3><p>即便用条件概率路径$p_t\left(x \mid x_1\right)$, 条件向量场来$u_t\left(x \mid x_1\right)$表示了边缘概率路径$p_t(x)$, 边缘向量场$u_t(x)$, 但是因为它们有积分, 而我们只能访问到实际分布的部分样本, 所以还是难以求解. 对于原来的Flow Matching Objective $\mathcal{L}_{\text {FM}}$ 中, 求解是不太可能的.</p><p>直觉上来说, <strong>如果直接学条件向量场有没有可能呢</strong>? 对于Conditional Flow Matching, 要学习的是一个条件向量场$u_t\left(x \mid x_1\right)$, 其训练目标为:</p><p>$$<br>\mathcal{L}_{\mathrm{CFM}}(\theta)=\mathbb{E}_{t, q\left(x_1\right), p_t\left(x \mid x_1\right)}\left\Vert v_t(x)-u_t\left(x \mid x_1\right)\right\Vert ^2<br>$$</p><p>其中$t \sim \mathcal{U}[0,1]$, $x_1 \sim q(x_1)$, $x \sim p_t(x \mid x_1)$. 此时的$p_t(x \mid x_1)$, $u_t(x \mid x_1)$ 只依赖于单个样本, 所以可以从$q(x_1)$ 中随便采样$x_1$ 来计算$p_t(x \mid x_1)$, $u_t(x \mid x_1)$.</p><blockquote><p>所以这个Loss其实和<a href="https://adaning.github.io/posts/24725.html">Rectified Flow</a>的训练目标是一样的.</p></blockquote><p>这俩目标函数有什么区别? 观察一下:</p><p>$$<br>\begin{equation}<br>\begin{aligned}<br>\mathcal{L}_{\text{FM}}=\left\Vert v_t(x)-u_t(x)\right\Vert ^2 &amp; =\left\Vert v_t(x)\right\Vert ^2-2\left\langle v_t(x), u_t(x)\right\rangle+\left\Vert u_t(x)\right\Vert ^2 \\<br>\mathcal{L}_{\text{CFM}}=\left\Vert v_t(x)-u_t\left(x \mid x_1\right)\right\Vert ^2 &amp; =\left\Vert v_t(x)\right\Vert ^2-2\left\langle v_t(x), u_t\left(x \mid x_1\right)\right\rangle+\left\Vert u_t\left(x \mid x_1\right)\right\Vert ^2<br>\end{aligned}<br>\end{equation}<br>$$</p><p>最后一项$\left\Vert u_t(x)\right\Vert ^2$, $\left\Vert u_t\left(x \mid x_1\right)\right\Vert ^2$ 是Ground Truth, 所以它与参数$\theta$ 的优化显然无关.</p><p>两个式子中的第一项$\left\Vert v_t(x)\right\Vert ^2$ 外面挂的期望不一样, 事实证明它们是相等的:</p><p>$$<br>\begin{equation}<br>\begin{aligned}<br>\mathbb{E}_{p_t(x)}\left\Vert v_t(x)\right\Vert ^2 &amp; =\int\left\Vert v_t(x)\right\Vert ^2 p_t(x) d x=\int\left\Vert v_t(x)\right\Vert ^2 p_t\left(x \mid x_1\right) q\left(x_1\right) d x_1 d x \\<br>&amp; =\mathbb{E}_{q\left(x_1\right), p_t\left(x \mid x_1\right)}\left\Vert v_t(x)\right\Vert ^2<br>\end{aligned}<br>\end{equation}<br>$$</p><p>第二项也是相等的:</p><p>$$<br>\begin{equation}<br>\begin{aligned}<br>\mathbb{E}_{p_t(x)}\left\langle v_t(x), u_t(x)\right\rangle &amp; =\int\left\langle v_t(x), \frac{\int u_t\left(x \mid x_1\right) p_t\left(x \mid x_1\right) q\left(x_1\right) d x_1}{p_t(x)}\right\rangle p_t(x) d x \\<br>&amp; =\int\left\langle v_t(x), \int u_t\left(x \mid x_1\right) p_t\left(x \mid x_1\right) q\left(x_1\right) d x_1\right\rangle d x \\<br>&amp; =\int\left\langle v_t(x), u_t\left(x \mid x_1\right)\right\rangle p_t\left(x \mid x_1\right) q\left(x_1\right) d x_1 d x \\<br>&amp; =\mathbb{E}_{q\left(x_1\right), p_t\left(x \mid x_1\right)}\left\langle v_t(x), u_t\left(x \mid x_1\right)\right\rangle,<br>\end{aligned}<br>\end{equation}<br>$$</p><p>所以经过上面一通折腾, 得到一个结论:</p><p>假设$p_t(x) &gt; 0$, 在独立于参数$\theta$ 的常数意义下, 有$\mathcal{L}_{\text {FM}}$ 与$\mathcal{L}_{\text {CFM}}$ <strong>等价</strong>, 且$\nabla_\theta \mathcal{L}_{\text{FM}}(\theta)=\nabla_\theta \mathcal{L}_{\text {CFM}}(\theta)$.</p><p>因此, <strong>可以通过直接学习Conditional Flow Matching来获得一个等价于Flow Matching得到的向量场</strong>, Conditional Flow Matching可以作为Flow Matching的<strong>代理目标</strong>.</p><h2 id="Conditional-Probability-Paths-and-Vector-Fields"><a href="#Conditional-Probability-Paths-and-Vector-Fields" class="headerlink" title="Conditional Probability Paths and Vector Fields"></a>Conditional Probability Paths and Vector Fields</h2><p>现在已知通过Conditional Flow Matching能完成Flow Matching的训练, 接下来该着手$p_t(x \mid x_1)$ 与$u_t(x \mid x_1)$ 的构造了.</p><p>一般的, 可以考虑高斯条件概率路径$p_t\left(x \mid x_1\right)$:</p><p>$$<br>p_t\left(x \mid x_1\right)=\mathcal{N}\left(x \mid \mu_t\left(x_1\right), \sigma_t\left(x_1\right)^2 I\right)<br>$$</p><p>其中$\mu : [0, 1] \times \mathbb{R}^d \rightarrow \mathbb{R}^d$ 为与时间相关的高斯分布均值, $\sigma :[0, 1] \times \mathbb{R}^d \rightarrow \mathbb{R}_{&gt;0}$ 为与时间相关的标准差.</p><p>简单的令$\mu_0(x_1)=0, \sigma_0(x_1)=1$, $t=0$ 时就有$p(x)=\mathcal{N}(x \mid 0, I)$. 继续令$\mu_1(x_1)=x_1, \sigma_1(x_1)=\sigma_{\min}$, $t=1$ 时$p_1(x \mid x_1)$ 为集中在$x_1$ 附近的高斯分布.</p><p>有无数中方法都能生成满足条件的概率路径, 我们可以简单点, 直接将Flow建模为高斯分布:</p><p>$$<br>\psi_t(x)=\sigma_t\left(x_1\right) x+\mu_t\left(x_1\right)<br>$$</p><p>$x$ 服从标准高斯分布, $\psi_t(x)$ 为一个仿射变换, 将$x$ 映射为均值$\mu_t(x_1)$, 标准差$\sigma_t(x_1)$ 的正态分布变量.</p><blockquote><p>这个形式就和Diffusion Model的建模形式一样了, 为噪声$x$ 和目标样本$x_1$ 之间的线性组合.</p></blockquote><p>而流$\psi_t(x)$ 可以将噪声分布$p_0(x \mid x_1)=p(x)$ 推到$p_t(x \mid x_1)$:</p><p>$$<br>\left[\psi_t\right]_\ast p(x)=p_t\left(x \mid x_1\right)<br>$$</p><p>流$\psi_t$ 提供了如下生成条件概率路径的条件向量场$u_t$:</p><p>$$<br>\frac{d}{d t} \psi_t(x)=u_t\left(\psi_t(x) \mid x_1\right)<br>$$</p><p>对$p_t(x \mid x_1)$ 做仅关于$x_0$ 的重参数, 代入到CFM的目标$\mathcal{L}_{\text{CFM}}$ 中有:</p><p>$$<br>\mathcal{L}_{\text {CFM }}(\theta)=\mathbb{E}_{t, q\left(x_1\right), p\left(x_0\right)}\left\Vert v_t\left(\psi_t\left(x_0\right)\right)-\frac{d}{d t} \psi_t\left(x_0\right)\right\Vert ^2<br>$$</p><p>$\psi_t$ 为简单的可逆仿射映射, 且它的唯一向量场具有如下形式:</p><p>$$<br>u_t\left(x \mid x_1\right)=\frac{\sigma_t^{\prime}\left(x_1\right)}{\sigma_t\left(x_1\right)}\left(x-\mu_t\left(x_1\right)\right)+\mu_t^{\prime}\left(x_1\right)<br>$$</p><p>$u_t\left(x \mid x_1\right)$ 就可以生成高斯路径$p_t\left(x \mid x_1\right)$. 至此, 我们就完成了条件向量场$u_t\left(x \mid x_1\right)$ 形式的构造.</p><hr><p>不过$u_t\left(x \mid x_1\right)$ 是怎么推导得到的?</p><p>令条件向量场$u_t(x \mid x_1)=w_t(x)$, 结合Flow $\psi_t$ 有:</p><p>$$<br>\frac{d}{d t} \psi_t(x)= w_t\left(\psi_t(x)\right)<br>$$</p><p>由于$\psi_t$ 可逆, 令$x=\psi_t^{-1}(y)$, 有:</p><p>$$<br>\psi_t^\prime(\psi^{-1}_{t}(y))=w_t(y)<br>$$</p><p>需要计算$\psi_t$ 对时间的导数. 别忘了前面定义过, $\psi_t$ 为一个高斯路径流, $x$ 为与时间无关的常数, 所以其对时间$t$ 的导数为:</p><p>$$<br>\psi_t^\prime(x) = \sigma^\prime_t(x_1) x + \mu_t^\prime(x_1)<br>$$</p><p>根据$\psi_t(x)$, 写出$x$ 的表达式:</p><p>$$<br>x = \frac{\psi_t(x) - \mu_t(x_1)}{\sigma_t(x_1)} = \frac{y - \mu_t(x_1)}{\sigma_t(x_1)}<br>$$</p><p>将$x$ 代入$\psi_t^\prime(x)$ 当中可得:</p><p>$$<br>\psi_t^\prime(x) = \frac{\sigma_t^{\prime}\left(x_1\right)}{\sigma_t\left(x_1\right)}\left(y-\mu_t\left(x_1\right)\right)+\mu_t^{\prime}\left(x_1\right)<br>$$</p><p>$\psi_t^\prime(\psi^{-1}_{t}(y))= \psi_t^\prime(x)=w_t(y)$, 有:</p><p>$$<br>w_t\left(y\right)=\frac{\sigma_t^{\prime}\left(x_1\right)}{\sigma_t\left(x_1\right)}\left(y-\mu_t\left(x_1\right)\right)+\mu_t^{\prime}\left(x_1\right)<br>$$</p><p>得证. 且该式子对于任意的$\mu_t(x_1), \sigma_t(x_1)$ 都是可用的.</p><h3 id="Special-Instances-of-Gaussian-Conditional-Probability-Paths"><a href="#Special-Instances-of-Gaussian-Conditional-Probability-Paths" class="headerlink" title="Special Instances of Gaussian Conditional Probability Paths"></a>Special Instances of Gaussian Conditional Probability Paths</h3><h4 id="Diffusion-Conditional-VFs"><a href="#Diffusion-Conditional-VFs" class="headerlink" title="Diffusion Conditional VFs"></a>Diffusion Conditional VFs</h4><p>Diffusion Model的Forward Process本身就是将目标样本$x_1$ 不断加噪, 然后得到纯噪声$x_0$ 的过程, 所以它可以被看做是一个随机过程.</p><p>对于Diffusion Model来说, 有两种Reverse Process可选.</p><p>一种是<strong>Variance Exploding</strong>(VE)方差爆炸型, 其概率路径$p_t\left(x \mid x_1\right)$ 形式为:</p><p>$$<br>p_t\left(x \mid x_1\right)=\mathcal{N}\left(x \mid x_1, \sigma_{1-t}^2 I\right)<br>$$</p><p>其中$\sigma_t$ 为递增函数, $\sigma_0 =0, \sigma_1 \gg 1$, 所以$t=1$ 时, $\sigma_0=0$, 集中在目标数据分布旁, $t=0$ $\sigma_1 \gg 1$, 接近纯噪声. 但是由于没有对$x_1$ 前面加调整的系数, 所以会导致整体的方差非常大.</p><p>在上式中, $p_t\left(x \mid x_1\right)$ 的$\mu_t(x_1) = x_1$, $\sigma_t(x_1) = \sigma_{1-t}$, 代入$u_t\left(x \mid x_1\right)$ 中可得:</p><p>$$<br>u_t\left(x \mid x_1\right)=-\frac{\sigma_{1-t}^{\prime}}{\sigma_{1-t}}\left(x-x_1\right)<br>$$</p><p>另一种为<strong>Variance Preserving</strong>(VP)方差保持型, 其概率路径$p_t\left(x \mid x_1\right)$ 形式为:</p><p>$$<br>p_t\left(x \mid x_1\right)=\mathcal{N}\left(x \mid \alpha_{1-t} x_1,\left(1-\alpha_{1-t}^2\right) I\right), \text { where } \alpha_t=e^{-\frac{1}{2} T(t)}, T(t)=\int_0^t \beta(s) d s<br>$$</p><p>其中, $\beta$ 为噪声缩放函数. 当$t=1$ 时, $a_0=1$ 接近目标数据分布, $t=0$ 时, $a_1 \approx 0$, 接近于纯噪声.</p><p>$p_t\left(x \mid x_1\right)$ 的$\mu_t(x_1) = \alpha_{1-t}x_1, \sigma_t(x_1) = \sqrt{1-\alpha_{1-t}^2}$, 代入$u_t\left(x \mid x_1\right)$ 中可得:</p><p>$$<br>u_t\left(x \mid x_1\right)=\frac{\alpha_{1-t}^{\prime}}{1-\alpha_{1-t}^2}\left(\alpha_{1-t} x-x_1\right)=-\frac{T^{\prime}(1-t)}{2}\left[\frac{e^{-T(1-t)} x-e^{-\frac{1}{2} T(1-t)} x_1}{1-e^{-T(1-t)}}\right]<br>$$</p><blockquote><p>感兴趣的可以自行查阅下DDIM的附录, 上面的情况对应的向量场$u_t(x \mid x_1)$ 与<a href="https://adaning.github.io/posts/40650.html">DDIM</a>里的向量场实际上是一样的. 因此, 我们沿着Flow Matching的思路就推出了经典的Diffusion Model 方法DDIM.</p></blockquote><h4 id="Optimal-Transport-Conditional-VFs"><a href="#Optimal-Transport-Conditional-VFs" class="headerlink" title="Optimal Transport Conditional VFs"></a>Optimal Transport Conditional VFs</h4><p>感觉沿着Diffusion的思路构造条件向量场还是有点复杂了些. 在条件概率路径中, 一个更直接更简单方法是直接让均值$\mu_t(x)$ 和标准差$\sigma_t(x)$ 都随时间线性变化, 即希望这条路径为一条空间中的直线:</p><p>$$<br>\begin{gathered}<br>\mu_t(x)=tx_1 \\<br>\sigma_t(x)=1-(1-\sigma_{\text{min}})t<br>\end{gathered}<br>$$</p><p>在这种设定下, 代入$u_t\left(x \mid x_1\right)$ 中可得:</p><p>$$<br>u_t\left(x \mid x_1\right)=\frac{x_1-\left(1-\sigma_{\min }\right) x}{1-\left(1-\sigma_{\min }\right) t}<br>$$</p><p>则对于$t \in [0, 1]$, 与$u_t\left(x \mid x_1\right)$ 对应的条件流(Conditional Flow)被定义为:</p><p>$$<br>\psi_t\left(x\right)=(1-(1-\sigma_{\text{min}})t)x + tx_1<br>$$</p><p>看起来这个就像对$x$ 和$x_1$ 的线性插值.</p><p>接着带入到$\mathcal{L}_{\mathrm{CFM}}(\theta)$ 中, 最终化简后可得:</p><p>$$<br>\mathcal{L}_{\mathrm{CFM}}(\theta)=\mathbb{E}_{t, q\left(x_1\right), p\left(x_0\right)}\left\Vert v_t\left(\psi_t\left(x_0\right)\right)-\left(x_1-\left(1-\sigma_{\min }\right) x_0\right)\right\Vert ^2<br>$$</p><blockquote><p>当$\sigma_{\min} \rightarrow 0$ 的时候, 似乎有$u_t(x \mid x_1) = x_1 - x_0$, 嗯… 这个结果似乎也有一些眼熟… 这不是<a href="https://adaning.github.io/posts/24725.html">Rectified Flow</a>的向量场形式吗?</p></blockquote><p>此时, 条件流$\psi_t$ 实际上是$p_0(x \mid x_1), p_1(x \mid x_1)$ 之间最优传输的位移映射. 在这种视角下, OT Path对应的粒子运动轨迹始终沿直线:</p><img src="https://cdn.jsdelivr.net/gh/ADAning/Image/MLDL/flow matching6.png" style="zoom:67%"><p>Diffusion Path对应的粒子运动轨迹则有可能冲过最终样本, 但是OT的则不会. Flow Matching和Rectified Flow得出了相同的结论.</p><p>对Diffusion Patch对应的Conditional Score Function($\nabla \log{p_t(x \mid x_1)}$)和OT Path的Conditional VF进行可视化:</p><img src="https://cdn.jsdelivr.net/gh/ADAning/Image/MLDL/flow matching7.png" style="zoom:67%"><p>蓝色代表大的值, 红色代表小的值. 可以发现:</p><ul><li>Diffusion Path: 速度场分布, 方向都随时间改变. 所以粒子运动服轨迹应该呈曲线.</li><li>OT Path: 速度场方向恒定, 都指向终点, 只是不同的时刻对应的速度场大小不同. 所以粒子运动轨迹应该呈直线.</li></ul><p>因此相较于Diffusion Path, OT Path具有更稳定的方向与更高效的向量场, OT Path是更容易训练的.</p><blockquote><p>注意, 上述直线只是理想情况下训练出来的速度场对应的粒子运动轨迹!!! 实际学习到的路径并不是始终是直线!!!</p></blockquote><p>下面选了几个ImageNet-64的Case:</p><img src="https://cdn.jsdelivr.net/gh/ADAning/Image/MLDL/flow matching8.png" style="zoom:50%"><p>发现OT Path比其他的方法更早生成能看得过去的样本(左图), 并且在推理次数比较少的情况下能获得更好的质量(右图).</p><h2 id="Recommended"><a href="#Recommended" class="headerlink" title="Recommended"></a>Recommended</h2><ul><li>强烈推荐看一下: <a href="https://zhuanlan.zhihu.com/p/11228697012" target="_blank" rel="noopener">零推导理解Diffusion和Flow Matching - 王峰的文章 - 知乎</a>, 这篇文章用几何的方式直接推导出了DDPM, DDIM, Flow Matching的形式, 并直观体现出它们的核心差异.</li><li>Meta出的官方解读: <a href="https://arxiv.org/abs/2412.06264" target="_blank" rel="noopener">Flow Matching Guide and Code</a>, 论文里的一些图对于理解Flow Matching中提到的概念有很大帮助.</li><li>抽象文章名系列:<ul><li><a href="https://zhuanlan.zhihu.com/p/8646384062" target="_blank" rel="noopener">Flow Matching （一）吃火锅等号270桌所以学习了一下FM 想与大家分享 - 董子斌的文章 - 知乎</a>.</li><li><a href="https://zhuanlan.zhihu.com/p/10926370916" target="_blank" rel="noopener">Flow Matching （二）被北京街道上弥漫不散的烟味熏得只得趴在地上湿抹布捂住口鼻写出 FM 代码完成对比实验 - 董子斌的文章 - 知乎</a>.</li></ul></li><li>关于Loss: <a href="https://www.zhihu.com/question/664448167/answer/74541749293" target="_blank" rel="noopener">扩散模型中，Flow Matching的训练方式相比于 DDPM 训练方法有何优势？ - CW不要無聊的風格的回答 - 知乎</a>.</li><li>B站UP童发发:<ul><li><a href="https://www.bilibili.com/video/BV1Wv3xeNEds/" target="_blank" rel="noopener">【AI知识分享】你一定能听懂的扩散模型Flow Matching流匹配基本原理深度解析_哔哩哔哩_bilibili</a>.</li><li><a href="https://www.bilibili.com/video/BV1E7ykYqEHd/" target="_blank" rel="noopener">【睡前小分享】扩散模型流匹配（Flow Matching）真实面目揭秘_哔哩哔哩_bilibili</a>.</li></ul></li></ul><h2 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h2><p>总结感觉该写的在<a href="https://adaning.github.io/posts/24725.html">Rectified Flow</a>里都写的差不多了, 这里就少写点.</p><p><a href="https://adaning.github.io/posts/40650.html">DDIM</a>, <a href="https://proceedings.neurips.cc/paper_files/paper/2022/hash/a98846e9d9cc01cfb87eb694d946ce6b-Abstract-Conference.html" target="_blank" rel="noopener">EDM</a>都可以看做是Flow Matching框架下的一种特殊形式.</p><p>与同期工作<a href="https://adaning.github.io/posts/24725.html">Rectified Flow</a>撞车也是一件非常有意思的事. 如果只是考虑工程上的话, 有了Flow Matching以后, 感觉可以绕过之前Diffusion Model的学习老路, 直接来学Flow Matching了.</p></div><hr><div class="reprint" id="reprint-statement"><div class="reprint__author"><span class="reprint-meta" style="font-weight:700"><i class="fas fa-user">文章作者: </i></span><span class="reprint-info"><a href="/about" rel="external nofollow noreferrer">DaNing</a></span></div><div class="reprint__type"><span class="reprint-meta" style="font-weight:700"><i class="fas fa-link">文章链接: </i></span><span class="reprint-info"><a href="https://ADAning.github.io/posts/19143.html">https://ADAning.github.io/posts/19143.html</a></span></div><div class="reprint__notice"><span class="reprint-meta" style="font-weight:700"><i class="fas fa-copyright">版权声明: </i></span><span class="reprint-info">本博客所有文章除特別声明外，均采用 <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a> 许可协议。转载请注明来源 <a href="/about" target="_blank">DaNing</a> !</span></div></div><script async defer>function navToReprintStatement(){$("html, body").animate({scrollTop:$("#reprint-statement").offset().top-80},800)}document.addEventListener("copy",function(t){M.toast({html:'<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>'})})</script><div class="tag_share" style="display:block"><div class="post-meta__tag-list" style="display:inline-block"><div class="article-tag"><a href="/tags/Diffusion/"><span class="chip bg-color">Diffusion</span> </a><a href="/tags/Flow/"><span class="chip bg-color">Flow</span> </a><a href="/tags/Flow-Matching/"><span class="chip bg-color">Flow Matching</span></a></div></div><div class="post_share" style="zoom:80%;width:fit-content;display:inline-block;float:right;margin:-.15rem 0"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/ADAning/ADAning.github.io/libs/share/css/share.min.css"><div id="article-share"><div class="social-share" data-sites="qq,wechat,weibo" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div><script src="https://cdn.jsdelivr.net/gh/ADAning/ADAning.github.io/libs/share/js/social-share.min.js"></script></div></div></div></div></div><style>.mvaline-card{margin:1.5rem auto}.mvaline-card .card-content{padding:20px 20px 5px 20px}</style><div class="card mvaline-card" data-aos="fade-up"><div class="comment_headling" style="font-size:20px;font-weight:700;position:relative;padding-left:20px;top:15px;padding-bottom:5px"><i class="fas fa-comments fa-fw" aria-hidden="true"></i> <span>评论</span></div><div id="mvcomments" class="card-content" style="display:grid"></div></div><script src="https://cdn.jsdelivr.net/gh/ADAning/ADAning.github.io/libs/minivaline/MiniValine.min.js"></script><script>new MiniValine({el:"#mvcomments",appId:"M2K91TQqrwW698jR08LdugNz-gzGzoHsz",appKey:"b04G08nTf4B3kqCfOOY1urvC",mode:"xCss",placeholder:"评论暂不支持Latex公式, 但支持Markdown语法.",pathname:window.location.pathname,lang:"",adminEmailMd5:"ebbfbc84f11742e41a94a4e64b1d37ab",tagMeta:["管理员","小伙伴","访客"],master:["ebbfbc84f11742e41a94a4e64b1d37ab"],friends:["b5bd5d836c7a0091aa8473e79ed4c25e","adb7d1cd192658a55c0ad22a3309cecf","3ce1e6c77b4910f1871106cb30dc62b0","cfce8dc43725cc14ffcd9fb4892d5bfc"],math:!1,md:!0,enableQQ:!0,NoRecordIP:!1,visitor:!1,maxNest:6,pageSize:12,serverURLs:"",emoticonUrl:["https://cdn.jsdelivr.net/npm/alus@latest","https://cdn.jsdelivr.net/gh/MiniValine/qq@latest","https://cdn.jsdelivr.net/gh/MiniValine/Bilibilis@latest","https://cdn.jsdelivr.net/gh/MiniValine/tieba@latest","https://cdn.jsdelivr.net/gh/MiniValine/twemoji@latest","https://cdn.jsdelivr.net/gh/MiniValine/weibo@latest"]})</script><article id="prenext-posts" class="prev-next articles"><div class="row article-row"><div class="article col s12 m6" data-aos="fade-up"><div class="article-badge left-badge text-color"><i class="fas fa-chevron-left"></i>&nbsp;上一篇</div><div class="card"><a href="/posts/32823.html"><div class="card-image"><img src="https://cdn.jsdelivr.net/gh/ADAning/ADAning.github.io/medias/featureimages/8.jpg" class="responsive-img" alt="TCSinger: Zero-Shot Singing Voice Synthesis with Style Transfer and Multi-Level Style Control"> <span class="card-title">TCSinger: Zero-Shot Singing Voice Synthesis with Style Transfer and Multi-Level Style Control</span></div></a><div class="card-content article-content"><div class="summary block-with-text">TCSinger: Zero-Shot Singing Voice Synthesis with Style Transfer and Multi-Level Style Control 论文: TCSinger: Zero-Shot Si</div><div class="publish-info"><span class="publish-date"><i class="far fa-clock fa-fw icon-date"></i>2025-07-01 </span><span class="publish-author"><i class="fas fa-bookmark fa-fw icon-category"></i> <a href="/categories/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/" class="post-category">深度学习</a></span></div></div><div class="card-action article-tags"><a href="/tags/Audio/"><span class="chip bg-color">Audio</span> </a><a href="/tags/SVS/"><span class="chip bg-color">SVS</span></a></div></div></div><div class="article col s12 m6" data-aos="fade-up"><div class="article-badge right-badge text-color">下一篇&nbsp;<i class="fas fa-chevron-right"></i></div><div class="card"><a href="/posts/24991.html"><div class="card-image"><img src="https://cdn.jsdelivr.net/gh/ADAning/ADAning.github.io/medias/featureimages/8.jpg" class="responsive-img" alt="MeanFlow: Mean Flows for One-step Generative Modeling"> <span class="card-title">MeanFlow: Mean Flows for One-step Generative Modeling</span></div></a><div class="card-content article-content"><div class="summary block-with-text">本文前置知识: Flow Matching: Flow Matching for Generative Modeling. 或者: Rectified Flow: ReFlow: Flow Straight and Fast: Le</div><div class="publish-info"><span class="publish-date"><i class="far fa-clock fa-fw icon-date"></i>2025-05-22 </span><span class="publish-author"><i class="fas fa-bookmark fa-fw icon-category"></i> <a href="/categories/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/" class="post-category">深度学习</a></span></div></div><div class="card-action article-tags"><a href="/tags/Diffusion/"><span class="chip bg-color">Diffusion</span> </a><a href="/tags/Flow/"><span class="chip bg-color">Flow</span> </a><a href="/tags/Flow-Matching/"><span class="chip bg-color">Flow Matching</span> </a><a href="/tags/Mean-Flow/"><span class="chip bg-color">Mean Flow</span></a></div></div></div></div></article></div><script type="text/javascript" src="https://cdn.jsdelivr.net/gh/ADAning/ADAning.github.io/libs/codeBlock/codeBlockFuction.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/gh/ADAning/ADAning.github.io/libs/codeBlock/codeLang.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/gh/ADAning/ADAning.github.io/libs/codeBlock/codeCopy.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/gh/ADAning/ADAning.github.io/libs/codeBlock/codeShrink.js"></script><style type="text/css">code[class*=language-],pre[class*=language-]{white-space:pre!important}</style></div><div id="toc-aside" class="expanded col l3 hide-on-med-and-down"><div class="toc-widget"><div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div><div id="toc-content"></div></div></div></div><div id="floating-toc-btn" class="hide-on-med-and-down"><a class="btn-floating btn-large bg-color"><i class="fas fa-list-ul"></i></a></div><script src="https://cdn.jsdelivr.net/gh/ADAning/ADAning.github.io/libs/tocbot/tocbot.min.js"></script><script>$(function(){tocbot.init({tocSelector:"#toc-content",contentSelector:"#articleContent",headingsOffset:-(.4*$(window).height()-45),collapseDepth:Number("0"),headingSelector:"h2, h3, h4"});let t=0,e="toc-heading-",n=($("#toc-content a").each(function(){$(this).attr("href","#"+e+ ++t)}),t=0,$("#articleContent").children("h2, h3, h4").each(function(){$(this).attr("id",e+ ++t)}),parseInt(.4*$(window).height()-64)),o=$(".toc-widget");$(window).scroll(function(){$(window).scrollTop()>n?o.addClass("toc-fixed"):o.removeClass("toc-fixed")});const i="expanded";let c=$("#toc-aside"),a=$("#main-content");$("#floating-toc-btn .btn-floating").click(function(){c.hasClass(i)?(c.removeClass(i).hide(),a.removeClass("l9")):(c.addClass(i).show(),a.addClass("l9"));{let e=$("#artDetail");if(0!==e.length){let t=e.width();450<=t?t+=21:350<=t&&t<450?t+=18:300<=t&&t<350?t+=16:t+=14,$("#prenext-posts").width(t)}return}})})</script></main><script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script><script>MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]]}}</script><footer class="page-footer bg-color"><div class="container row center-align" style="margin-bottom:0!important"><div class="col s12 m8 l8 copy-right">Copyright&nbsp;&copy; <span id="year">2020</span> <a href="/about" target="_blank">DaNing</a> |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a> |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a><br>&nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span class="white-color">438k</span>&nbsp;字 <span id="busuanzi_container_site_pv">|&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span id="busuanzi_value_site_pv" class="white-color"></span>&nbsp;次 </span><span id="busuanzi_container_site_uv">|&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span id="busuanzi_value_site_uv" class="white-color"></span>&nbsp;人</span><br><br></div><div class="col s12 m4 l4 social-link social-statis"><a href="https://github.com/ADAning" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50"><i class="fab fa-github"></i> </a><a href="mailto:andaning@163.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50"><i class="fas fa-envelope-open"></i> </a><a href="https://www.zhihu.com/people/nzhu-27" class="tooltipped" target="_blank" data-tooltip="关注我的知乎: https://www.zhihu.com/people/nzhu-27" data-position="top" data-delay="50"><i class="fab fa-zhihu1">知</i></a></div></div></footer><div class="progress-bar"></div><div id="searchModal" class="modal"><div class="modal-content"><div class="search-header"><span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span> <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字" class="search-input"></div><div id="searchResult"></div></div></div><script src="https://cdn.jsdelivr.net/gh/ADAning/ADAning.github.io/js/search.js"></script><script type="text/javascript">$(function(){searchFunc("https://cdn.jsdelivr.net/gh/ADAning/ADAning.github.io/search.xml","searchInput","searchResult")})</script><div id="backTop" class="top-scroll"><a class="btn-floating btn-large waves-effect waves-light" href="#!"><i class="fas fa-angle-double-up"></i></a></div><script src="https://cdn.jsdelivr.net/gh/ADAning/ADAning.github.io/libs/materialize/materialize.min.js"></script><script src="https://cdn.jsdelivr.net/gh/ADAning/ADAning.github.io/libs/masonry/masonry.pkgd.min.js"></script><script src="https://cdn.jsdelivr.net/gh/ADAning/ADAning.github.io/libs/aos/aos.js"></script><script src="https://cdn.jsdelivr.net/gh/ADAning/ADAning.github.io/libs/scrollprogress/scrollProgress.min.js"></script><script src="https://cdn.jsdelivr.net/gh/ADAning/ADAning.github.io/libs/lightGallery/js/lightgallery-all.min.js"></script><script src="https://cdn.jsdelivr.net/gh/ADAning/ADAning.github.io/js/matery.js"></script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js",(e=document.getElementsByTagName("script")[0]).parentNode.insertBefore(t,e)}()</script><script async src="https://cdn.jsdelivr.net/gh/ADAning/ADAning.github.io/libs/others/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/gh/ADAning/ADAning.github.io/libs/instantpage/instantpage.js" type="module"></script></body></html>